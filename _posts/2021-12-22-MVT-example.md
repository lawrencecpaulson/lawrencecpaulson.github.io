---
layout: post
title:  "Readability in proofs: the mean value theorem"
usemathjax: true 
tags: examples, Isabelle, mean value theorem
---

Doing mathematics requires a combination of intuition and rigour. Intuition is the source of ideas and conjectures. Proofs need to be rigorous, while at the same time avoiding excessive detail, which would destroy readability. That is why we need intuition even to read a proof, let alone to conceive the theorem in the first place. How can we capture intuition in a formal proof?

### The mean value theorem

Our example, the *mean value theorem*, is an elementary fact about the differential calculus:

* If $\phi(x)$ is continuous in the closed interval $[a,b]$, and differentiable in the open interval, then there is a value $\xi$ of $x$ between $a$ and $b$, such that $\phi(b)-\phi(a) = (b-a)\phi'(\xi)$.

GH Hardy, in his legendary *Pure Mathematics* (CUP, 1952), begins as follows (p. 242):

> Before we give a strict proof of this theorem, which is one of the most important theorems in the differential calculus, it will be well to point out its obvious geometrical meaning. This is simply that, if the curve $APB$ has a tangent at all points of its length, then there must be a point, such as $P$, where the tangent is parallel to $AB$. For $\phi'(\xi)$ is the tangent of the angle which the tangent at $P$ makes with $OX$, and $(\phi(b) - \phi(a))/(b - a)$ the tangent of the angle which $AB$ makes with $OX$.

Here is Hardy's accompanying diagram:

![MVT diagram](/images/Hardy-MVT.png)

Hardy continues:

> It is easy to give a strict proof. Consider the function

> $$\phi(b) - \phi(x) - \frac{b-x}{b-a}(\phi(b)-\phi(a))$$

> which vanishes when $x = a$ and $x = b$. It follows from [Rolle's Theorem] that there is a value $\xi$ for which its derivative vanishes. But this derivative is

> $$ \frac{\phi(b)-\phi(a)}{b-a} - \phi'(x) $$

> which proves the theorem.

The proof in the Isabelle/HOL library is slightly different, defining a function `f` that does not actually vanish (no need for that) and its derivative has the opposite sign. Nevertheless, the formal proof contains essentially the same application of Rolle's theorem.

### The MVT formalised in Isabelle/HOL


The Isabelle proof rewards closer inspection. The theorem's assumptions
include $a<b$ and the continuity and differentiability conditions on $\phi$. If you recall the earlier post on [undefined values]({% post_url 2021-12-01-Undefined %}), you'll understand why differentiability is expressed by a relation that actually names the derivative as $\phi'$. 
The conclusion of the theorem asserts that we "obtain" some $\xi$ satisfying the required properties. The **obtains** keyword is one way to express an existential conclusion.

<pre class="source"><span class="keyword1"></span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_47..54">theorem</span></span></span><span> </span><span class="entity_def" id="Calculus.mvt|fact"><span class="entity_def" id="Calculus.mvt|thm"><span>mvt</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>real</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>real</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span>contf</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>continuous_on</span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>..</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span> </span><span class="free"><span>φ</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_153..157">derf</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>φ</span></span><span> </span><span class="keyword1"><span>has_derivative</span></span><span> </span><span class="free"><span>φ'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>at</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>obtains</span></span></span><span> </span><span class="free"><span>ξ</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>ξ</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>ξ</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>φ'</span></span><span> </span><span class="free"><span>ξ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>-</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_284..290">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>f</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>-</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∃</span></span><span class="bound"><span>ξ</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>ξ</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="bound"><span>ξ</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>φ'</span></span><span> </span><span class="bound"><span>ξ</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>-</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><span>Rolle_deriv</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span>›</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_478..479">x</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="skolem"><span>x</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>f</span></span><span> </span><span class="keyword1"><span>has_derivative</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>φ'</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>φ</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>-</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>at</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span>f_def<span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><span class="dynamic"><span class="dynamic"><span>derivative_intros</span></span></span><span> </span>derf<span> </span>x<span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span>assms<span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span>f_def<span> </span><span class="dynamic"><span class="dynamic"><span>field_simps</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>continuous_on</span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>..</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span> </span><span class="skolem"><span>f</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span>f_def<span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><span class="dynamic"><span class="dynamic"><span>continuous_intros</span></span></span><span> </span>assms<span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>pos_le_divide_eq</span><span> </span><span>pos_less_divide_eq</span><span> </span>that<span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span>
</pre>

In the proof we see the `f` being defined for use with Rolle's theorem, whose conditions are then proved. The conclusion follows by simple algebra. Our exposition is not as clear as Hardy's, but we see how `f` is defined and what its crucial properites are. This proof, being machine-checked, is rigorous, while retaining a bit of intuition: we don't have to spell out any more detail.

Looking closer at the proof justifications, we see multiple uses of the `intro` method to prove differentiability and continuity of `f`. The `smt` justification was generated automatically by Sledgehammer.

### Postscript

GH Hardy's textbook *Pure Mathematics* is aimed at first-year mathematics undergraduates. It covers analysis up to "the general theory of the logarithmic, exponential, and circular functions". Hardy's Preface states "I regard the book as being really elementary." First published in 1908, it has gone through ten editions and is still in print.

The file containing the MVT example is available to [download](/Isabelle-Examples/MVT.thy).

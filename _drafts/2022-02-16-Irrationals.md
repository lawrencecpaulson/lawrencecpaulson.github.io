---
layout: post
title:  "A classical proof: exponentials are irrational"
usemathjax: true
tags: examples, Isabelle, Proofs from THE BOOK
---

In *[Proofs from THE BOOK](https://link.springer.com/book/10.1007/978-3-662-57265-8)*, Aigner and Ziegler
present hundreds of classic proofs from what we might call the mathematical canon, based in large part on suggestions by [Paul Erdős](https://www.ams.org/notices/199801/comm-erdos.pdf).
The authors confine themselves to proofs requiring "only a modest amount of technique from undergraduate mathematics".
Nothing too advanced or specialised, but nevertheless, a selection of insightful techniques across the mathematical landscape.
Here we look at an Isabelle/HOL proof that the exponential function yields irrational numbers.

### Statement of the problem

Since $\exp(\ln x)=x$, we need to qualify that claim: $\exp r$ is irrational for all rational, nonzero $r$. And this will imply that $\ln r$ is irrational for every positive rational $r≠1$.

The authors present a simple 19th-century [proof](https://proofsfromthebook.github.io/7) (alternative [source](https://planetmath.org/erisirrationalforrinmathbbqsetminus0)) that relies on nothing other than differentiation and integration.
I have recently [formalised it](https://www.isa-afp.org/entries/Irrationals_From_THEBOOK.html) for the Archive of Formal Proofs
and we can look at some highlights here.

We consider the function

$$ f(x) = \frac{x^n (1-x)^n}{n!} $$

<pre class="source">
<span class="keyword1 command entity_def">definition</span> <span class="entity entity_def" id="Irrationals_From_THEBOOK.hf|const">hf</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="free">hf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span>real</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span>fact</span> <span class="bound">n</span><span>"</span></span>

<span class="keyword1 command entity_def" id="Irrationals_From_THEBOOK.cf_def|fact">definition</span> <span class="entity entity_def">cf</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="free">cf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">n</span><span class="main">)</span><span>"</span></span>

<span class="keyword1 command">text</span> <span class="quoted plain_text"><span>‹</span><span>Mere knowledge that the coefficients are integers is not enough later on.</span><span>›</span></span>
<span class="keyword1 command">lemma</span> hf_int_poly<span class="main">:</span>
  <span class="keyword2 keyword">fixes</span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2 keyword">shows</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
<span class="keyword1 command">proof</span>
  <span class="keyword3 command">fix</span> <span class="skolem">x</span>
  <span class="keyword1 command">have</span> inj<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>inj_on</span> <span class="main">(</span><span class="main">(+)</span><span class="free">n</span><span class="main">)</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> <span>inj_on_def</span><span class="main">)</span>
  <span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">(+)</span><span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>nat_le_iff_add</span> <span class="keyword1 command">by</span> <span class="operator">fastforce</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span>real</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">unfolding</span> <span>binomial_ring</span> <span class="keyword1 command">by</span> <span class="operator">simp</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>mult.assoc</span> <span class="quasi_keyword">flip</span><span class="main main">:</span> <span>power_minus</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>sum_distrib_left</span> <span>mult_ac</span> <span>power_add</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">n</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>sum.reindex</span> <span class="main main">[</span><span class="operator">OF</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_1034..1037"><span>inj</span></a><span class="main main">,</span> <span class="operator">simplified</span><span class="main main">]</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf_def|fact"><span>cf_def</span></a><span class="main">)</span>
  <span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="free">n</span><span class="main">..</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a><span class="main">)</span>
  <span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf_def|fact"><span>cf_def</span></a><span class="main">)</span>
  <span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>sum.union_disjoint</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted quoted"><span>"</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="main">{</span><span class="free">n</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span>"</span></span><span class="main">]</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>ivl_disj_int_two</span><span class="main main">(</span><span>7</span><span class="main main">)</span> <span>ivl_disj_un_two</span><span class="main main">(</span><span>7</span><span class="main main">)</span> <span>mult_2</span><span class="main">)</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">text</span> <span class="quoted plain_text"><span>‹</span><span>Lemma (ii) in the text has strict inequalities, but it takes more work and is less useful.</span><span>›</span></span>
<span class="keyword1 command entity_def" id="offset_2207..2212">lemma</span>
  <span class="keyword2 keyword">assumes</span> <span class="quoted quoted"><span>"</span><span class="main">0</span> <span class="main">≤</span> <span class="free">x</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span>"</span></span>
  <span class="keyword2 keyword">shows</span> hf_nonneg<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">0</span> <span class="main">≤</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="free">x</span><span>"</span></span> <span class="keyword2 keyword">and</span> hf_le_inverse_fact<span class="main">:</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span>fact</span> <span class="free">n</span><span>"</span></span>
  <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_2207..2212"><span>assms</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a> <span class="dynamic dynamic">divide_simps</span> <span>mult_le_one</span> <span>power_le_one</span><span class="main">)</span>

<span class="keyword1 command">lemma</span> hf_differt <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="free">x</span><span>"</span></span>
  <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_int_poly|fact"><span>hf_int_poly</span></a> <span>differentiable_def</span>
  <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic dynamic">derivative_eq_intros</span> <span>exI</span> <span class="main keyword3">|</span> <span class="operator">simp</span><span class="main">)</span><span class="main keyword3">+</span>

<span class="keyword1 command">lemma</span> deriv_sum_int<span class="main">:</span>
  <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span>
     <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span class="main">(</span><span>int</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">(</span><span>Suc</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
  <span class="main">(</span><span class="keyword2 keyword">is</span> <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="var">?f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?g</span><span class="main">)</span><span>"</span></span><span class="main">)</span>
<span class="keyword1 command">proof</span> <span class="operator">-</span>
  <span class="keyword1 command entity_def" id="offset_2754..2758">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="var">?f</span> <span class="keyword1">has_real_derivative</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span>
  <span class="keyword1 command">proof</span> <span class="operator">-</span>
    <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span>Suc</span> <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span>real</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span>real_of_int</span> <span class="main">(</span><span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_2754..2758"><span>that</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>sum.atLeast_Suc_atMost</span> <span class="quasi_keyword">intro</span><span class="main main">!</span><span class="main main">:</span> <span>sum.cong</span><span class="main">)</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span>sum</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span>real</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span>real_of_int</span> <span class="main">(</span><span class="free">c</span> <span class="main">(</span><span>Suc</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span>Suc</span> <span class="main">0</span><span class="main">..</span><span>Suc</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span>"</span></span>
      <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_2754..2758"><span>that</span></a> <span class="keyword1 command">by</span> <span class="operator">simp</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="var">?g</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.comm_monoid_add_class.sum.atLeast_atMost_pred_shift|fact"><span>sum.atLeast_atMost_pred_shift</span></a> <span class="main main">[</span><span class="keyword2 keyword operator">where</span><span> m</span><span class="main main main">=</span><span class="quoted main">0</span><span class="main main">]</span><span class="main">)</span>
    <span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> §<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">a</span> <span class="main">-</span> <span>Suc</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?g</span><span>"</span></span> <span class="keyword1 command">.</span>
    <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic dynamic">derivative_eq_intros</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3287..3288"><span>§</span></a> <span class="main keyword3">|</span> <span class="operator">simp</span><span class="main">)</span><span class="main keyword3">+</span>
  <span class="keyword1 command">qed</span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main main">:</span> <span>DERIV_imp_deriv</span><span class="main">)</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">text</span> <span class="quoted plain_text"><span>‹</span><span>We calculate the coefficients of the $k$th derivative precisely.</span><span>›</span></span>
<span class="keyword1 command">lemma</span> hf_deriv_int_poly<span class="main">:</span>
   <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span>int</span><span class="main">(</span><span class="main">∏</span><span class="main">{</span><span class="bound">i</span><span class="main">&lt;..</span><span class="bound">i</span><span class="main">+</span><span class="free">k</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
<span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">k</span><span class="main">)</span>
  <span class="keyword3 command">case</span> <span>0</span>
  <span class="keyword3 command">show</span> <span class="var quoted var">?case</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_int_poly|fact"><span>hf_int_poly</span></a><span class="main">)</span>
<span class="keyword1 command">next</span>
  <span class="keyword3 command">case</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3 command entity_def" id="offset_3776..3782">define</span> <span class="skolem skolem">F</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">F</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span>int</span><span class="main">(</span><span class="main">∏</span><span class="main">{</span><span class="bound">i</span><span class="main">&lt;..</span><span class="bound">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">have</span> Fd<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">F</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">x</span>
    <span class="keyword1 command">unfolding</span> <span>field_differentiable_def</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3776..3782"><span>F_def</span></a>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic dynamic">derivative_eq_intros</span> <span>exI</span> <span class="main keyword3">|</span> <span class="operator">force</span><span class="main">)</span><span class="main keyword3">+</span>
  <span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span>prod</span> <span>int</span> <span class="main">{</span><span class="skolem">i</span><span class="main">&lt;..</span><span>Suc</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span>int</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span>prod</span> <span>int</span> <span class="main">{</span><span>Suc</span> <span class="skolem">i</span><span class="main">&lt;..</span><span>Suc</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">}</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span>Suc_le_mono</span> <span>atLeastSucAtMost_greaterThanAtMost</span> <span>le_add1</span> <span>of_nat_Suc</span> <span>prod.head</span><span class="main">)</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">x</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span>Suc</span> <span class="skolem">k</span><span class="main">.</span> <span>real_of_int</span> <span class="main">(</span><span>int</span><span class="main">(</span><span class="main">∏</span><span class="main">{</span><span class="bound">i</span><span class="main">&lt;..</span><span class="bound">i</span><span class="main">+</span> <span>Suc</span> <span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf|const"><span>cf</span></a> <span class="free">n</span> <span class="main">(</span><span>Suc</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span>fact</span> <span class="free">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">x</span>
    <span class="keyword1 command">unfolding</span> <span>deriv_cdivide_right</span> <span class="main">[</span><span class="operator">OF</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3876..3878"><span>Fd</span></a><span class="main">]</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3776..3782"><span>F_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.deriv_sum_int|fact"><span>deriv_sum_int</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf_def|fact"><span>cf_def</span></a> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main main">:</span> <span>of_int_mult</span> <span class="quasi_keyword">intro</span><span class="main main">:</span> <span>sum.cong</span><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?case</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3767..3770"><span>Suc</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_3776..3782"><span>F_def</span></a><span class="main">)</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">lemma</span> hf_deriv_0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span>
<span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted quoted"><span>"</span><span class="free">n</span> <span class="main">≤</span> <span class="free">k</span><span>"</span></span><span class="main">)</span>
  <span class="keyword3 command">case</span> <span>True</span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">j</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>fact</span> <span class="free">k</span><span class="main">::</span><span>real</span><span class="main">)</span> <span class="main">=</span> <span>real_of_int</span> <span class="skolem">j</span> <span class="main">*</span> <span>fact</span> <span class="free">n</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>fact_dvd</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span>dvd_def</span> <span>fact_nonzero</span> <span>mult.commute</span> <span>nonzero_mult_div_cancel_left</span> <span>of_int_fact</span> <span>real_of_int_div</span><span class="main">)</span>
  <span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>prod</span> <span>real</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span>fact</span> <span class="free">k</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>fact_prod</span> <span>atLeastSucAtMost_greaterThanAtMost</span><span class="main">)</span>
  <span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_int_poly|fact"><span>hf_deriv_int_poly</span></a> <span>dvd_def</span><span class="main">)</span>
<span class="keyword1 command">next</span>
  <span class="keyword3 command">case</span> <span>False</span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_int_poly|fact"><span>hf_deriv_int_poly</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf_def|fact"><span>cf_def</span></a><span class="main">)</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">lemma</span> deriv_hf_minus<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
<span class="keyword1 command">proof</span>
  <span class="keyword3 command">fix</span> <span class="skolem">x</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="main">=</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>fun_eq_iff</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a> <span>mult.commute</span><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="operator">fastforce</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span>deriv</span> <span class="main">(</span><span class="main">(-)</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">x</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span>real_derivative_chain</span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span> <span>deriv</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="operator">simp</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">lemma</span> deriv_n_hf_diffr <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="free">x</span><span>"</span></span>
  <span class="keyword1 command">unfolding</span> <span>field_differentiable_def</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_int_poly|fact"><span>hf_deriv_int_poly</span></a>
  <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic dynamic">derivative_eq_intros</span> <span>exI</span> <span class="main keyword3">|</span> <span class="operator">force</span><span class="main">)</span><span class="main keyword3">+</span>

<span class="keyword1 command">lemma</span> deriv_n_hf_minus<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
<span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">k</span><span class="main">)</span>
  <span class="keyword3 command">case</span> <span>0</span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?case</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>fun_eq_iff</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a><span class="main">)</span>
<span class="keyword1 command">next</span>
  <span class="keyword3 command">case</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1 command">have</span> o<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(-)</span> <span class="main">1</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="operator">auto</span>
  <span class="keyword3 command">show</span> <span class="var quoted var">?case</span>
  <span class="keyword1 command">proof</span>
    <span class="keyword3 command">fix</span> <span class="skolem">x</span>
    <span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(-)</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main main">:</span> <span>field_differentiable_compose</span><span class="main">)</span>
    <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span>Suc</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span>deriv</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_5842..5845"><span>Suc</span></a><span class="main">)</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> <span>deriv</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span>"</span></span>
      <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_5856..5857"><span>o</span></a> <span class="keyword1 command">by</span> <span class="operator">fastforce</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span>Suc</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span>Suc</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">subst</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_5856..5857"><span>o</span></a><span class="main keyword3">,</span> <span class="operator">subst</span> <span>deriv_chain</span><span class="main keyword3">,</span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span>Suc</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span>Suc</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span>Suc</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span>"</span></span> <span class="keyword1 command">.</span>
  <span class="keyword1 command">qed</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command">subsection</span> <span class="quoted plain_text"><span>‹</span><span>Towards the main result</span><span>›</span></span>

<span class="keyword1 command">lemma</span> hf_deriv_1<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span>
  <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span>Ints_1</span> <span>Ints_minus</span> <span>Ints_mult</span> <span>Ints_power</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.deriv_n_hf_minus|fact"><span>deriv_n_hf_minus</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_0|fact"><span>hf_deriv_0</span></a><span class="main">)</span>

<span class="keyword1 command">lemma</span> hf_deriv_eq_0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="free">k</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.cf_def|fact"><span>cf_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_int_poly|fact"><span>hf_deriv_int_poly</span></a><span class="main">)</span>

<span class="keyword1 command">text</span> <span class="quoted plain_text"><span>‹</span><span>The case for positive integers</span><span>›</span></span>
<span class="keyword1 command entity_def" id="offset_6847..6852">lemma</span> exp_nat_irrational<span class="main">:</span>
  <span class="keyword2 keyword">assumes</span> <span class="quoted quoted"><span>"</span><span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">shows</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="main">(</span><span>real_of_int</span> <span class="free">s</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℚ</span><span>"</span></span>
<span class="keyword1 command">proof</span>
  <span class="keyword3 command">assume</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="main">(</span><span>real_of_int</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span><span>"</span></span>
  <span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">a</span> <span class="skolem skolem">b</span> <span class="keyword2 keyword">where</span> ab<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span>coprime</span> <span class="skolem">a</span> <span class="skolem">b</span><span>"</span></span> <span class="keyword2 keyword">and</span> exp_s<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="free">s</span> <span class="main">=</span> <span>of_int</span> <span class="skolem">a</span> <span class="main">/</span> <span>of_int</span> <span class="skolem">b</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>Rats_cases'</span> <span>div_0</span> <span>exp_not_eq_zero</span> <span>of_int_0</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span>exp_gt_zero</span> <span>of_int_0_less_iff</span> <span>zero_less_divide_iff</span><span class="main">)</span>
  <span class="keyword3 command entity_def" id="offset_7196..7202">define</span> <span class="skolem skolem">n</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">n</span> <span class="main">≡</span> <span>nat</span> <span class="main">(</span><span>max</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">s</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> ns3<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="free">s</span><span class="main">^</span><span class="numeral">3</span> <span class="main">≤</span> <span>real</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">3</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="operator">linarith</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7196..7202"><span>n_def</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span>zero_less_nat_eq</span> <span>zero_less_power</span><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span>power_increasing</span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span>real_of_int</span><span class="main">(</span><span class="free">s</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>power_mult</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span>
    <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7255..7258"><span>ns3</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>power_mono</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span>exp</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>exp_le</span> <span class="quoted quoted"><span>‹</span><span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="dynamic dynamic">divide_simps</span><span class="main">)</span>
  <span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> s_le<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span>exp</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="operator">presburger</span>
  <span class="keyword1 command">have</span> a_less<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">a</span> <span class="main">&lt;</span> <span>sqrt</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span>pi</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">proof</span> <span class="operator">-</span>
    <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="numeral">2</span><span class="main">*</span><span>pi</span> <span class="main">&gt;</span> <span class="main">1</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>z3</span><span class="main main">)</span> <span>pi_gt_zero</span> <span>sin_gt_zero_02</span> <span>sin_le_zero</span><span class="main">)</span>
    <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">a</span> <span class="main">=</span> <span>sqrt</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6988..6990"><span>ab</span></a><span class="main main">(</span><span>1</span><span class="main main">)</span> <span>order_less_imp_le</span><span class="main">)</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">≤</span> <span>sqrt</span> <span class="skolem">n</span><span>"</span></span>
      <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7196..7202"><span>n_def</span></a>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> ccfv_SIG</span><span class="main main">)</span> <span>int_nat_eq</span> <span>of_nat_less_of_int_iff</span> <span>real_sqrt_le_mono</span><span class="main">)</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">&lt;</span> <span>sqrt</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span>pi</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="quoted quoted"><span>‹</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span><span>›</span></span> <span class="quoted quoted"><span>‹</span><span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span>pi</span><span>›</span></span><span class="main">)</span>
    <span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span> <span class="keyword1 command">.</span>
  <span class="keyword1 command">qed</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>sqrt</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span>pi</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span>exp</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>mult_strict_right_mono</span> <span class="main">[</span><span class="operator">OF</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7811..7817"><span>a_less</span></a><span class="main">]</span> <span>mult_left_mono</span> <span class="main">[</span><span class="operator">OF</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7747..7751"><span>s_le</span></a><span class="main">]</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7747..7751"><span>s_le</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6988..6990"><span>ab</span></a><span class="main main">(</span><span>1</span><span class="main main">)</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <span>of_int_1</span> <span>of_int_le_iff</span> <span>of_int_mult</span> <span>zero_less_power</span><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> n<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>fact</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>fact_bounds</span><span class="main">(</span><span>1</span><span class="main">)</span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span class="quoted quoted"><span>‹</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span><span>›</span></span> <span>of_int_fact</span> <span>of_int_less_iff</span><span class="main">)</span>
  <span class="keyword3 command entity_def" id="offset_8597..8603">define</span> <span class="skolem skolem">F</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">F</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">s</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span>deriv</span><span class="main">^^</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span>"</span></span>
  <span class="keyword1 command">have</span> <span>Fder</span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="skolem">F</span> <span class="keyword1">has_real_derivative</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="skolem">F</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">x</span>
  <span class="keyword1 command">proof</span> <span class="operator">-</span>
    <span class="keyword1 command entity_def" id="offset_8789..8793">have</span> *<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>sum</span> <span class="skolem">f</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span>sum</span> <span class="skolem">f</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">}</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">f</span><span class="main">::</span><span class="quoted quoted"><span>"</span><span>nat</span> <span class="main">⇒</span> <span>real</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span>lessThan_Suc_atMost</span> <span>sum.lessThan_Suc</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_8789..8793"><span>that</span></a><span class="main">)</span>
    <span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>deriv</span> <span class="main">(</span><span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span>"</span></span>
      <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_eq_0|fact"><span>hf_deriv_eq_0</span></a> <span class="main">[</span><span class="keyword2 keyword operator">where</span><span> k</span><span class="main main">=</span> <span class="quoted quoted"><span>"</span><span>Suc</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span><span>"</span></span><span class="main">]</span> <span class="keyword1 command">by</span> <span class="operator">simp</span>
    <span class="keyword1 command">have</span> §<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span>Suc</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">*</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">+</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span>deriv</span> <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">*</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span><span>›</span></span>
      <span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">subst</span> <span>sum_Suc_reindex</span><span class="main">)</span>
      <span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="dynamic dynamic">algebra_simps</span> <span>atLeast0AtMost</span><span class="main">)</span>
      <span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_8794..8795"><span>*</span></a> <span>mult.left_commute</span> <span class="main main">[</span><span class="operator">of</span> <span class="quoted quoted"><span>"</span><span>of_int</span> <span class="free">s</span><span>"</span></span><span class="main main">]</span> <span>minus_nat.diff_Suc</span> <span>sum_distrib_left</span>
                   <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main main">:</span> <span>sum.distrib</span> <span class="quasi_keyword">intro</span><span class="main main">!</span><span class="main main">:</span> <span>comm_monoid_add_class.sum.neutral</span> <span class="quasi_keyword">split</span><span class="main main">:</span> <span>nat.split_asm</span><span class="main">)</span>
      <span class="keyword1 command improper command">done</span>
    <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span>
      <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_8597..8603"><span>F_def</span></a>
      <span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic dynamic">derivative_eq_intros</span> <span>field_differentiable_derivI</span> <span class="main keyword3">|</span> <span class="operator">simp</span><span class="main">)</span><span class="main keyword3">+</span>
      <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9062..9063"><span>§</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="dynamic dynamic">algebra_simps</span> <span>atLeast0AtMost</span> <span>eval_nat_numeral</span><span class="main">)</span>
  <span class="keyword1 command">qed</span>

  <span class="keyword1 command">have</span> F01_Ints<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">F</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">F</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_8597..8603"><span>F_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_0|fact"><span>hf_deriv_0</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_1|fact"><span>hf_deriv_1</span></a> <span>Ints_sum</span><span class="main">)</span>
  <span class="keyword3 command entity_def" id="offset_9898..9904">define</span> <span class="skolem skolem">sF</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">sF</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>exp</span> <span class="main">(</span><span>of_int</span> <span class="free">s</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">F</span> <span class="bound">x</span><span>"</span></span>
  <span class="keyword3 command entity_def" id="offset_9952..9958">define</span> <span class="skolem skolem">sF'</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">sF'</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span>Suc</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span>exp</span> <span class="main">(</span><span>of_int</span> <span class="free">s</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">have</span> sF_der<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="skolem">sF</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">sF'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">x</span>
    <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9898..9904"><span>sF_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> <span>refl</span> <span class="dynamic dynamic">derivative_eq_intros</span> <span class="main keyword3">|</span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> <span class="dynamic dynamic">algebra_simps</span><span class="main">)</span><span class="main keyword3">+</span>
  <span class="keyword1 command">let</span> <span class="var quoted var">?N</span> <span class="main">=</span> <span class="quoted quoted"><span>"</span><span class="skolem">b</span> <span class="main">*</span> <span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">sF'</span><span>"</span></span>
  <span class="keyword1 command">have</span> sF'_integral<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="skolem">sF'</span> <span class="keyword1">has_integral</span> <span class="skolem">sF</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">sF</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">)</span> <span>fundamental_theorem_of_calculus</span> <span>has_field_derivative_iff_has_vector_derivative</span> <span>has_vector_derivative_at_within</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_10040..10046"><span>sF_der</span></a><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="var">?N</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">0</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span>integral_unique</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7026..7031"><span>exp_s</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9898..9904"><span>sF_def</span></a> <span class="dynamic dynamic">algebra_simps</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span>
    <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_deriv_1|fact"><span>hf_deriv_1</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9806..9814"><span>F01_Ints</span></a><span class="main">)</span>
  <span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> N_Ints<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="var">?N</span> <span class="main">∈</span> <span class="main">ℤ</span><span>"</span></span> <span class="keyword1 command">.</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">sF'</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">and</span> ge0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">sF'</span> <span class="bound">x</span><span>"</span></span>
    <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a><span class="main">)</span>
  <span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>continuous_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">sF'</span><span>"</span></span>
    <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_def|fact"><span>hf_def</span></a> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic dynamic">continuous_intros</span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1 command">ultimately</span> <span class="keyword1 command entity_def" id="offset_10874..10878">have</span> <span class="quoted">False</span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="skolem">sF'</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span>has_integral_0_cbox_imp_0</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted main">0</span> <span class="quoted main">1</span> <span class="quoted skolem">sF'</span> <span class="quoted quoted"><span>"</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span>"</span></span><span class="main">]</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_10874..10878"><span>that</span></a> <span class="keyword1 command">by</span> <span class="operator">auto</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">sF'</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_10670..10673"><span>ge0</span></a> <span>has_integral_nonneg</span> <span>integral_unique</span> <span>order_le_less</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_10236..10248"><span>sF'_integral</span></a><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">0</span> <span class="main">&lt;</span> <span class="var">?N</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="quoted quoted"><span>‹</span><span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span><span class="main">)</span>
  <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">sF'</span> <span class="main">=</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span>Suc</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>exp</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">unfolding</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a> <span class="keyword1 command">by</span> <span class="operator">force</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">≤</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span>Suc</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span>exp</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
  <span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">rule</span> <span>mult_left_mono</span><span class="main">)</span>
    <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>exp</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span>real</span><span class="main">.</span> <span>exp</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">intro</span> <span>mult_mono</span> <span>integral_le</span><span class="main">)</span>
      <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>exp</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span>"</span></span>
        <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="main">0</span> <span class="main">&lt;</span> <span class="var">?N</span><span>›</span></span> <span>not_integrable_integral</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a> <span class="keyword1 command">by</span> <span class="operator">fastforce</span>
    <span class="keyword1 command">qed</span> <span class="main">(</span><span class="operator">use</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_nonneg|fact"><span>hf_nonneg</span></a> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf_le_inverse_fact|fact"><span>hf_le_inverse_fact</span></a> <span class="keyword2 keyword quasi_keyword">in</span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">=</span> <span>exp</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span>
      <span class="keyword1 command">by</span> <span class="operator">simp</span>
    <span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span>integral</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span>exp</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.hf|const"><span>hf</span></a> <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span>exp</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span> <span class="keyword1 command">.</span>
  <span class="keyword1 command">qed</span> <span class="main">(</span><span class="operator">use</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_6847..6852"><span>assms</span></a> <span class="keyword2 keyword quasi_keyword">in</span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="var">?N</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">*</span> <span>of_int</span> <span class="free">s</span> <span class="main">^</span> <span>Suc</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span>exp</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span>fact</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span>
    <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_9952..9958"><span>sF'_def</span></a> <span>mult_ac</span> <span class="dynamic dynamic">divide_simps</span><span class="main">)</span>
  <span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span><span>"</span></span>
    <span class="keyword1 command">using</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_8481..8482"><span>n</span></a> <span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="dynamic dynamic">field_simps</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_7026..7031"><span>exp_s</span></a><span class="main">)</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span>of_int_fact</span> <span>of_int_less_iff</span> <span>of_int_mult</span> <span>of_int_power</span><span class="main">)</span>
  <span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="quoted">False</span>
    <span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="main">0</span> <span class="main">&lt;</span> <span class="var">?N</span><span>›</span></span> <span>Ints_cases</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_10624..10630"><span>N_Ints</span></a> <span class="keyword1 command">by</span> <span class="operator">force</span>
<span class="keyword1 command">qed</span>

<span class="keyword1 command entity_def" id="offset_12212..12219">theorem</span> exp_irrational<span class="main">:</span>
  <span class="keyword2 keyword">fixes</span> <span class="free">q</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2 keyword">assumes</span> <span class="quoted quoted"><span>"</span><span class="free">q</span> <span class="main">∈</span> <span class="main">ℚ</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="free">q</span> <span class="main">≠</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">shows</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="free">q</span> <span class="main">∉</span> <span class="main">ℚ</span><span>"</span></span>
<span class="keyword1 command">proof</span>
  <span class="keyword3 command">assume</span> q<span class="main">:</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="free">q</span> <span class="main">∈</span> <span class="main">ℚ</span><span>"</span></span>
  <span class="keyword3 command">obtain</span> <span class="skolem skolem">s</span> <span class="skolem skolem">t</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">t</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="free">q</span> <span class="main">=</span> <span>of_int</span> <span class="skolem">s</span> <span class="main">/</span> <span>of_int</span> <span class="skolem">t</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span>Rats_cases'</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_12212..12219"><span>assms</span></a> <span>div_0</span> <span>of_int_0</span><span class="main">)</span>
  <span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span>exp</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span>nat</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span>exp</span> <span class="skolem">s</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> best</span><span class="main main">)</span> <span>exp_divide_power_eq</span> <span>of_nat_nat</span> <span>zero_less_nat_eq</span><span class="main">)</span>
  <span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span>exp</span> <span class="free">q</span> <span class="main">^</span> <span class="main">(</span><span>nat</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span><span>"</span></span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#offset_12310..12311"><span>q</span></a><span class="main">)</span>
  <span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="quoted">False</span>
    <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span><span>verit</span><span class="main main">,</span><span> del_insts</span><span class="main main">)</span> <span>Rats_inverse</span> <span class="quoted quoted"><span>‹</span><span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span><span>›</span></span> <span>exp_minus</span> <a class="entity_ref" href="Irrationals_From_THEBOOK.html#Irrationals_From_THEBOOK.exp_nat_irrational|fact"><span>exp_nat_irrational</span></a> <span>of_int_of_nat</span><span class="main">)</span>
<span class="keyword1 command">qed</span>
</pre>
  

---
layout: post
title:  "Small examples involving binomial coefficients"
usemathjax: true
tags: examples Isabelle Fibonacci
---

The binomial coefficients arise in the binomial theorem.
They are the elements of Pascal's triangle and satisfy a great many mathematical identities.
Below, we examine some of these. The theory </span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">theory "</span></span></span>HOL.Binomial<span>"</span><span class="antiquote">}
contains basic definitions and proofs, including the binomial theorem itself:

binomial

Many textbooks on discrete mathematics cover binomial coefficients.
Information about them is widely available on the Internet,
including Wikipedia and the lecture course notes available here:

http://www.cs.columbia.edu/~cs4205/files/CM4.pdf

It follows from the binomial theorem,
which is available under 


<pre class="source">
<span class="keyword1 command">lemma</span> choose_row_sum<span class="main">:</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">n</span> <span class="keyword1">choose</span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span></span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span>"</span><span>
  </span><span class="keyword1 command">using</span> binomial <span class="main">[</span><span class="operator">of</span> <span class="quoted main">1</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">1</span></span><span>"</span></span> <span class="quoted free">n</span><span class="main">]</span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> numeral_2_eq_2<span class="main">)</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> sum_choose_lower<span class="main">:</span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span></span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">n</span><span class="main">)</span> <span class="operator">auto</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> sum_choose_upper<span class="main">:</span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="bound">k</span> <span class="keyword1">choose</span></span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span></span> Suc <span class="free">n</span> <span class="keyword1">choose</span> Suc <span class="free">m</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">n</span><span class="main">)</span> <span class="operator">auto</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> sum_choose_diagonal<span class="main">:</span><span>
  </span><span class="keyword2 keyword">assumes</span> <span class="quoted"><span class="quoted"><span>"</span><span class="free">m</span><span class="main">≤</span></span><span class="free">n</span><span>"</span></span><span>
    </span><span class="keyword2 keyword">shows</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span></span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span></span> <span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">m</span><span>"</span><span>
</span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span></span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span></span> <span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">+</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">using</span> sum.atLeastAtMost_rev <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span></span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span></span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span>"</span> <span class="quoted main">0</span> <span class="quoted free">m</span><span class="main">]</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> atMost_atLeast0 <span class="quoted"><span class="quoted"><span>‹</span><span class="free">m</span><span class="main">≤</span></span><span class="free">n</span><span>›</span></span><span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> Suc</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">+</span><span class="free">m</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">m</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> sum_choose_lower<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> Suc</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">m</span><span>"</span> <span class="keyword1 command">using</span> assms<span>
    </span><span class="keyword1 command">by</span> <span class="operator">simp</span><span>
  </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span> <span class="keyword1 command">.</span><span>
</span><span class="keyword1 command">qed</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> fact_fact_dvd_fact_m<span class="main">:</span><span>
    </span><span class="keyword2 keyword">fixes</span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span><span>
    </span><span class="keyword2 keyword">shows</span> <span class="quoted"><span class="quoted"><span>"</span><span class="free">k</span> <span class="main">≤</span></span> <span class="free">n</span> <span class="main">⟹</span> fact</span> <span class="free">k</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">dvd</span> fact <span class="free">n</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> binomial_fact_lemma dvd_def of_nat_fact of_nat_mult<span class="main">)</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> fact_fact_dvd_fact<span class="main">:</span><span>
    </span><span class="keyword2 keyword">fixes</span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span><span>
    </span><span class="keyword2 keyword">shows</span> <span class="quoted"><span class="quoted"><span>"</span>fact</span> <span class="free">k</span> <span class="main">*</span></span> fact <span class="free">n</span> <span class="keyword1">dvd</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> fact_fact_dvd_fact_m diff_add_inverse2 le_add2<span class="main">)</span>
</pre>

$\binom{n}{m} \binom{m}{k} = \binom{n}{k} \binom{n-k}{m-k}$ can be
</span><span>proved by expressing binomial coefficients in terms of factorials:

<pre class="source">
<span class="keyword1 command">lemma</span> choose_mult_lemma<span class="main">:</span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span></span> <span class="free">r</span> <span class="main">+</span></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">m</span><span class="main">)</span><span>"</span><span>
  </span><span class="main">(</span><span class="keyword2 keyword">is</span> <span class="quoted"><span class="quoted"><span>"</span><span class="var">?lhs</span> <span class="main">=</span></span> <span class="main">_</span><span>"</span></span><span class="main">)</span><span>
</span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="var">?lhs</span> <span class="main">=</span></span><span>
      </span>fact</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> binomial_altdef_nat<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> fact</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span><span>
                 </span><span class="main">(</span>fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> add_implies_diff add_le_mono1 choose_dvd diff_cancel2 div_mult_div_if_dvd le_add1 le_add2<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> fact</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> <span class="dynamic dynamic">algebra_simps</span> fact_fact_dvd_fact<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> <span class="main">(</span>fact</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="operator">simp</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span><span>
      </span><span class="main">(</span>fact</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fact <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">r</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> Binomial.fact_fact_dvd_fact div_mult_div_if_dvd mult.assoc mult.commute<span class="main">)</span><span>
  </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> binomial_altdef_nat mult.commute<span class="main">)</span><span>
</span><span class="keyword1 command">qed</span>
</pre>

The "Subset of a Subset" identity.

<pre class="source">
<span class="keyword1 command">lemma</span> choose_mult<span class="main">:</span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free">k</span> <span class="main">≤</span></span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">≤</span></span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
  </span><span class="keyword1 command">using</span> choose_mult_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span>"</span><span class="free">m</span><span class="main">-</span></span><span class="free">k</span><span>"</span></span> <span class="quoted"><span class="quoted"><span>"</span><span class="free">n</span><span class="main">-</span></span><span class="free">m</span><span>"</span></span> <span class="quoted free">k</span><span class="main">]</span> <span class="keyword1 command">by</span> <span class="operator">simp</span>
</pre>

the following theorem, which relates to a weighted sum of a row of Pascal's triangle.
It involves arithmetic on type @{typ real} as well as @{typ nat}, so the function @{const real}
is implicitly inserted at multiple points.


<pre class="source">
<span class="keyword1 command">lemma</span> choose_row_sum_weighted<span class="main">:</span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span></span> <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
</span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">m</span><span class="main">)</span><span>
  </span><span class="keyword3 command">case</span> 0 <span class="keyword3 command">show</span> <span class="var quoted var">?case</span> <span class="keyword1 command">by</span> <span class="operator">simp</span><span>
</span><span class="keyword1 command">next</span><span>
  </span><span class="keyword3 command">case</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span>
  </span><span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
  </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span>"</span><span class="free">r</span> <span class="main">&lt;</span></span> Suc</span> <span class="skolem">m</span><span>"</span><span class="main">)</span><span>
    </span><span class="keyword3 command">case</span> True<span>
    </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> Suc binomial_eq_0<span class="main">)</span><span>
  </span><span class="keyword1 command">next</span><span>
    </span><span class="keyword3 command">case</span> False<span>
    </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">1</span></span> <span class="main">+</span></span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> real <span class="skolem">m</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span>
             </span><span class="main">=</span> real <span class="main">(</span><span class="free">r</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> Suc <span class="skolem">m</span><span class="main">)</span><span>"</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">,</span> best<span class="main main">)</span> left_diff_distrib mult_of_nat_commute not_less of_nat_Suc of_nat_diff<span class="main">)</span><span>
    </span><span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span></span> real</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">choose</span> Suc <span class="skolem">m</span><span class="main">)</span><span>"</span><span>
      </span><span class="keyword1 command">using</span> binomial_absorption<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span>"</span>Suc</span> <span class="skolem">m</span><span>"</span></span> <span class="quoted free">r</span><span class="main">]</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">,</span> ccfv_SIG<span class="main main">)</span> binomial_absorb_comp of_nat_Suc of_nat_add of_nat_mult<span class="main">)</span><span>
    </span><span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> Suc left_diff_distrib mult.assoc<span class="main">)</span><span>
  </span><span class="keyword1 command">qed</span><span>
</span><span class="keyword1 command">qed</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> sum_drop_zero<span class="main">:</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc</span> <span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span></span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">n</span><span class="main">)</span> <span class="operator">auto</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> sum_choose_drop_zero<span class="main">:</span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc</span> <span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span></span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span>
    </span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span>"</span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> trans <span class="main main">[</span><span class="operator">OF</span> sum.cong sum_drop_zero<span class="main main">]</span><span class="main">)</span> <span class="operator">auto</span>
</pre>

<pre class="source">
<span class="keyword1 command">lemma</span> ne_diagonal_fib<span class="main">:</span><span>
   </span><span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span></span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">choose</span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> fib <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span>"</span><span>
</span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted free">n</span> <span class="quasi_keyword">rule</span><span class="main main">:</span> fib.induct<span class="main">)</span><span>
  </span><span class="keyword3 command">case</span> 1 <span class="keyword3 command">show</span> <span class="var quoted var">?case</span> <span class="keyword1 command">by</span> <span class="operator">simp</span><span>
</span><span class="keyword1 command">next</span><span>
  </span><span class="keyword3 command">case</span> 2 <span class="keyword3 command">show</span> <span class="var quoted var">?case</span> <span class="keyword1 command">by</span> <span class="operator">simp</span><span>
</span><span class="keyword1 command">next</span><span>
  </span><span class="keyword3 command">case</span> <span class="main">(</span>3 <span class="skolem">n</span><span class="main">)</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc</span> <span class="skolem">n</span><span class="main">.</span> Suc</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span><span>
        </span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main main">:</span> choose_reduce_nat<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc</span> <span class="skolem">n</span><span class="main">.</span> Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span><span>
                   </span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> sum.distrib<span class="main">)</span><span>
  </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted"><span class="quoted"><span>"</span><span class="main">…</span> <span class="main">=</span></span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Suc</span> <span class="skolem">n</span><span class="main">.</span> Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">j</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span>"</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> sum_choose_drop_zero<span class="main">)</span><span>
  </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?case</span> <span class="keyword1 command">using</span> 3<span>
    </span><span class="keyword1 command">by</span> <span class="operator">simp</span><span>
</span><span class="keyword1 command">qed</span>
</pre>

choose your induction rule with care
The precise statement of the induction formula is also important
å
<pre class="source">
</pre>

<pre class="source">
</pre>

<pre class="source">
</pre>

<pre class="source">
</pre>

<pre class="source">
</pre>

---
layout: post
title:  "Wetzel's problem and the continuum hypothesis"
usemathjax: true 
tags: set theory, ZFC_in_HOL, ZFC
---

The [continuum hypothesis](https://plato.stanford.edu/entries/continuum-hypothesis/) (CH) dates from the 19th century and became the first of David [Hilbert's famous unsolved problems](https://en.wikipedia.org/wiki/Hilbert%27s_problems). Gödel proved it to be consistent with the axioms of set theory (ZFC), while Cohen exhibited models of ZFC in which CH failed. New axioms would be needed to settle the question. Despite decades of intensive research, the status of CH [remains open](https://www.quantamagazine.org/how-many-numbers-exist-infinity-proof-moves-math-closer-to-an-answer-20210715/).
However recondite it may be, CH should not be ignored: ordinary-looking mathematical questions occasionally bump into it.

### What is the continuum hypothesis anyway?

CH can be expressed by the mysterious formula $2^{\aleph_0}=\aleph_1$, and yet it is a simple question. A set is *countable* if its elements can be written in a series. The concept of countability was readily accepted by 19th century mathematicians, who by assuming facts such as "a countable union of countable sets is countable" found themselves depending on the [axiom of choice](https://plato.stanford.edu/entries/axiom-choice/) (AC) before it had even been promulgated.

[Cantor](https://en.wikipedia.org/wiki/Georg_Cantor) had proved that the algebraic numbers were countable and that the real numbers were not, raising the question of whether some intermediate set $X$ of real numbers existed, itself uncountable but of smaller cardinality than $\mathbb{R}$.
And that concept could be expressed simply in terms of the existence (or not) of a bijection between $X$ and $\mathbb{R}$.
No need for cardinal numbers or AC. 

### The story of Wetzel's problem

I first learned of Wetzel's problem from [*Proofs from THE BOOK*](https://link.springer.com/book/10.1007/978-3-662-57265-8) by Aigner and Ziegler, a compendium of beautiful proofs, many somehow connected with the legendary Hungarian mathematician, Paul Erdős. It involves some complex analysis, fortunately only a tiny bit, because that's all I know myself. Wetzel asked

> If $\\{f_\alpha\\}$ is a family of distinct [analytic functions](https://en.wikipedia.org/wiki/Analytic_function) (on some fixed domain) such that for each $z$ the set of values $\\{f_\alpha(z)\\}$ is countable, is the family itself countable?

Erdős stumbled upon this question in a problem book and in 1964 [published a solution](https://projecteuclid.org/journals/michigan-mathematical-journal/volume-11/issue-1/An-interpolation-problem-associated-with-the-continuum-hypothesis/10.1307/mmj/1028999028.full): Wetzel's question is equivalent to the negation of CH, and therefore independent of the generally accepted axioms of set theory.

Erdős first assumes ¬CH. He then shows that for any family of analytic functions $\\{f_\alpha\\}$ of size $\aleph_1$ there exists a complex number $z$ such that all $\aleph_1$ values $\\{f_\alpha(z)\\}$ are distinct and therefore this set is uncountable.

If on the other hand CH holds, Erdős shows how, by transfinite induction, one can construct a family $\\{f_\alpha\\}$ of cardinality $\aleph_1$ such that $\\{f_\alpha(z)\\}$ is countable for all $z$.

Garcia and Shoemaker have written a brief [history of the problem](https://arxiv.org/abs/1406.5085) and its origins.

### Wetzel's problem in Isabelle/HOL


<pre class="source">
<span class="keyword1 command">definition</span> <span class="entity">Wetzel</span> <span class="main">::</span> <span class="quoted quoted"><span>"</span><span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span> set <span class="main">⇒</span> bool<span>"</span></span><span>
  </span><span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="free">Wetzel</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">analytic_on</span> UNIV<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> countable<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">z</span><span class="main">)</span> <span class="main">`</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span>"</span></span>
</pre>

Proving the case when ¬CH.

<pre class="source">
<span class="keyword1 command">proposition</span> Erdos_Wetzel_nonCH<span class="main">:</span><span>
  </span><span class="keyword2 keyword">assumes</span> W<span class="main">:</span> <span class="quoted quoted"><span>"</span>Wetzel <span class="free">F</span><span>"</span></span> <span class="keyword2 keyword">and</span> NCH<span class="main">:</span> <span class="quoted quoted"><span>"</span>C_continuum <span class="main">&gt;</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span> <span class="keyword2 keyword">and</span> <span class="quoted quoted"><span>"</span>small <span class="free">F</span><span>"</span></span><span>
  </span><span class="keyword2 keyword">shows</span> <span class="quoted quoted"><span>"</span>countable <span class="free">F</span><span>"</span></span><span>
</span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">z0</span><span class="main">.</span> gcard <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">z0</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">≥</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span>uncountable <span class="free">F</span><span>"</span></span><span>
  </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
    </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>gcard <span class="free">F</span> <span class="main">≥</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span>small <span class="free">F</span><span>›</span></span> that uncountable_gcard_ge <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">F'</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span><span>"</span></span> <span class="keyword2 keyword">and</span> F'<span class="main">:</span> <span class="quoted quoted"><span>"</span>gcard <span class="skolem">F'</span> <span class="main">=</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> Card_Aleph Ord_1 subset_smaller_gcard <span class="quoted quoted"><span>‹</span>small <span class="free">F</span><span>›</span></span><span class="main">)</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">φ</span> <span class="keyword2 keyword">where</span> φ<span class="main">:</span> <span class="quoted quoted"><span>"</span>bij_betw <span class="skolem">φ</span> <span class="main">(</span>elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F'</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> TC_small eqpoll_def gcard_eqpoll<span class="main">)</span><span>
    </span><span class="keyword3 command">define</span> <span class="skolem skolem">S</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">S</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">α</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">φ</span> <span class="bound">β</span> <span class="bound">z</span><span class="main">}</span><span>"</span></span><span>
    </span><span class="keyword1 command">have</span> co_S<span class="main">:</span> <span class="quoted quoted"><span>"</span>gcard <span class="main">(</span><span class="skolem">S</span> <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">α</span> <span class="main">∈</span> elts <span class="skolem">β</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">α</span> <span class="skolem">β</span><span>
    </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
      </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">φ</span> <span class="skolem">α</span> <span class="keyword1">holomorphic_on</span> UNIV<span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">φ</span> <span class="skolem">β</span> <span class="keyword1">holomorphic_on</span> UNIV<span>"</span></span><span>
        </span><span class="keyword1 command">using</span> W <span class="quoted quoted"><span>‹</span><span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span><span>›</span></span> <span class="keyword1 command">unfolding</span> Wetzel_def<span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> Ord_ω1 Ord_trans φ analytic_imp_holomorphic bij_betwE subsetD that<span class="main">)</span><span class="main keyword3">+</span><span>
      </span><span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">φ</span> <span class="skolem">α</span> <span class="main">≠</span> <span class="skolem">φ</span> <span class="skolem">β</span><span>"</span></span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Ord_ω1 Ord_in_Ord Ord_trans OrdmemD φ bij_betw_imp_inj_on inj_on_def less_V_def that<span class="main">)</span><span>
      </span><span class="keyword1 command">ultimately</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>countable <span class="main">(</span><span class="skolem">S</span> <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">using</span> holomorphic_countable_equal_UNIV <span class="keyword1 command">unfolding</span> S_def <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
      </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
        </span><span class="keyword1 command">using</span> countable_imp_g_le_Aleph0 <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
    </span><span class="keyword1 command">qed</span><span>
    </span><span class="keyword3 command">define</span> <span class="skolem skolem">SS</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">SS</span> <span class="main">≡</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">β</span><span class="main">.</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">α</span> <span class="bound">β</span><span class="main">)</span> <span class="main">`</span> elts <span class="bound">β</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>  elts<span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">have</span> F'_eq<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">F'</span> <span class="main">=</span>  <span class="skolem">φ</span> <span class="main">`</span> elts ω1<span>"</span></span><span>
      </span><span class="keyword1 command">using</span> φ bij_betw_imp_surj_on <span class="keyword1 command">by</span> <span class="operator">auto</span><span>
    </span><span class="keyword1 command">have</span> §<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">∈</span> elts ω1 <span class="main">⟹</span> gcard <span class="main">(</span><span class="main">⋃</span><span class="bound">α</span><span class="main">∈</span>elts <span class="bound">xa</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">α</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">≤</span> ω<span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Aleph_0 TC_small co_S countable_UN countable_iff_g_le_Aleph0 less_ω1_imp_countable<span class="main">)</span><span>
    </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>gcard <span class="skolem">SS</span> <span class="main">≤</span> gcard <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">β</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">α</span><span class="main">∈</span>elts <span class="bound">β</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">α</span> <span class="bound">β</span><span class="main">)</span> <span class="main">`</span> elts ω1<span class="main">)</span> <span class="main">⊗</span> <span class="main">ℵ</span><span class="main">0</span><span>"</span></span><span>
      </span><span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> SS_def<span class="main">)</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span class="main main">(</span>no_types<span class="main main">,</span> lifting<span class="main main">)</span> <span class="quoted"><span>"</span>§<span>"</span></span> TC_small gcard_Union_le_cmult imageE<span class="main">)</span><span>
    </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span>  <span class="main">≤</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span><span>
    </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">rule</span> cmult_InfCard_le<span class="main">)</span><span>
      </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>gcard <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">β</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">α</span><span class="main">∈</span>elts <span class="bound">β</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">α</span> <span class="bound">β</span><span class="main">)</span> <span class="main">`</span> elts ω1<span class="main">)</span> <span class="main">≤</span> ω1<span>"</span></span><span>
        </span><span class="keyword1 command">using</span> gcard_image_le <span class="keyword1 command">by</span> <span class="operator">fastforce</span><span>
    </span><span class="keyword1 command">qed</span> <span class="operator">auto</span><span>
    </span><span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>gcard <span class="skolem">SS</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span> <span class="keyword1 command">.</span><span>
    </span><span class="keyword1 command">with</span> NCH <span class="keyword3 command">obtain</span> <span class="skolem skolem">z0</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">z0</span> <span class="main">∉</span> <span class="skolem">SS</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Complex_gcard UNIV_eq_I less_le_not_le<span class="main">)</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="skolem">z0</span><span class="main">)</span> <span class="main">(</span>elts ω1<span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> SS_def S_def inj_on_def<span class="main">)</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Ord_ω1 Ord_in_Ord Ord_linear<span class="main">)</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>gcard <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">z0</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> F' F'_eq gcard_image imageE inj_on_def<span class="main">)</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> TC_small <span class="quoted quoted"><span>‹</span><span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span><span>›</span></span> image_mono subset_imp_gcard_le<span class="main">)</span><span>
  </span><span class="keyword1 command">qed</span><span>
  </span><span class="keyword1 command">with</span> W <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
    </span><span class="keyword1 command">unfolding</span> Wetzel_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> countable uncountable_gcard_ge<span class="main">)</span><span>
</span><span class="keyword1 command">qed</span>
</pre>



Proving the case when CH.

<pre class="source">
<span class="keyword1 command">proposition</span> Erdos_Wetzel_CH<span class="main">:</span><span>
  </span><span class="keyword2 keyword">assumes</span> CH<span class="main">:</span> <span class="quoted quoted"><span>"</span>C_continuum <span class="main">=</span> <span class="main">ℵ</span><span class="main">1</span><span>"</span></span><span>
  </span><span class="keyword2 keyword">obtains</span> <span class="free">F</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span>Wetzel <span class="free">F</span><span>"</span></span> <span class="keyword2 keyword">and</span> <span class="quoted quoted"><span>"</span>uncountable <span class="free">F</span><span>"</span></span><span>
</span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
  </span><span class="keyword3 command">define</span> <span class="skolem skolem">D</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">D</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">}</span><span>"</span></span><span>
  </span><span class="keyword1 command">have</span> Deq<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">ℚ</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="main">ℚ</span><span class="main">.</span> <span class="main">{</span>Complex <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">using</span> complex.collapse <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> D_def<span class="main">)</span><span>
  </span><span class="keyword1 command">with</span> countable_rat <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>countable <span class="skolem">D</span><span>"</span></span><span>
    </span><span class="keyword1 command">by</span> <span class="operator">blast</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>infinite <span class="skolem">D</span><span>"</span></span><span>
    </span><span class="keyword1 command">unfolding</span> Deq<span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> infinite_disjoint_family_imp_infinite_UNION Rats_infinite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> disjoint_family_on_def<span class="main">)</span><span>
  </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> Re <span class="bound">w</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="bound">w</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> norm <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">z</span> <span class="keyword2 keyword">and</span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span><span>
  </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
    </span><span class="keyword3 command">obtain</span> <span class="skolem skolem">x</span> <span class="skolem skolem">y</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">x</span><span class="main">∈</span><span class="main">ℚ</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">y</span><span class="main">∈</span><span class="main">ℚ</span><span>"</span></span> <span class="keyword2 keyword">and</span> xy<span class="main">:</span> <span class="quoted quoted"><span>"</span>dist <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">,</span> Im <span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span><span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span><span>›</span></span> Rats_closure_real2 <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> closure_approachable<span class="main">)</span><span>
    </span><span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>dist <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">,</span> Im <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span>Complex <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> norm_complex_def norm_prod_def dist_norm<span class="main">)</span><span>
    </span><span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> Re <span class="bound">w</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="bound">w</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> norm <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> complex.sel<span class="main">)</span><span>
  </span><span class="keyword1 command">qed</span><span>
  </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> cloD<span class="main">:</span> <span class="quoted quoted"><span>"</span>closure <span class="skolem">D</span> <span class="main">=</span> UNIV<span>"</span></span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> D_def closure_approachable dist_complex_def<span class="main">)</span><span>
  </span><span class="keyword3 command">obtain</span> <span class="skolem skolem">ζ</span> <span class="keyword2 keyword">where</span> ζ<span class="main">:</span> <span class="quoted quoted"><span>"</span>bij_betw <span class="skolem">ζ</span> <span class="main">(</span>elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span>complex set<span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Complex_gcard TC_small assms eqpoll_def gcard_eqpoll<span class="main">)</span><span>
  </span><span class="keyword3 command">define</span> <span class="skolem skolem">inD</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">inD</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">β</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">α</span> <span class="main">∈</span> elts <span class="bound">β</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">ζ</span> <span class="bound">α</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">)</span><span>"</span></span><span>
  </span><span class="keyword3 command">define</span> <span class="skolem skolem">Φ</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">β</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">β</span> <span class="keyword1">analytic_on</span> UNIV <span class="main">∧</span> <span class="skolem">inD</span> <span class="bound">β</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">β</span><span class="main">)</span> <span class="main">∧</span> inj_on <span class="bound">f</span> <span class="main">(</span>elts <span class="main">(</span>succ <span class="bound">β</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
  </span><span class="keyword1 command">have</span> *<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="skolem">γ</span> <span class="main">(</span><span class="main">(</span>restrict <span class="skolem">f</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">γ</span><span class="main">:=</span><span class="bound">h</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword2 keyword">if</span> γ<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">and</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">β</span> <span class="skolem">f</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">γ</span> <span class="skolem">f</span><span>
  </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
    </span><span class="keyword1 command">have</span> f<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">β</span> <span class="keyword1">analytic_on</span> UNIV <span class="main">∧</span> <span class="skolem">inD</span> <span class="bound">β</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">β</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> Φ_def<span class="main">)</span><span>
    </span><span class="keyword1 command">have</span> inj<span class="main">:</span> <span class="quoted quoted"><span>"</span>inj_on <span class="skolem">f</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> Φ_def inj_on_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Ord_ω1 Ord_in_Ord Ord_linear<span class="main">)</span><span>
    </span><span class="keyword3 command">obtain</span> <span class="skolem skolem">h</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="keyword1">analytic_on</span> UNIV<span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">inD</span> <span class="skolem">γ</span> <span class="skolem">h</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="bound">β</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted quoted"><span>"</span>finite <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span class="main">)</span><span>
      </span><span class="keyword3 command">case</span> True<span>
      </span><span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">η</span> <span class="keyword2 keyword">where</span> η<span class="main">:</span> <span class="quoted quoted"><span>"</span>bij_betw <span class="skolem">η</span> <span class="main">{..&lt;</span>card <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">using</span> bij_betw_from_nat_into_finite <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">g</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">g</span> <span class="main">≡</span> <span class="skolem">f</span> <span class="keyword1">o</span> <span class="skolem">η</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">w</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">w</span> <span class="main">≡</span> <span class="skolem">ζ</span> <span class="keyword1">o</span> <span class="skolem">η</span><span>"</span></span><span>
      </span><span class="keyword1 command">have</span> gf<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound bound">i</span><span class="main">&lt;</span>card <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">β</span><span class="main">∈</span>elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="bound">β</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">h</span><span>
        </span><span class="keyword1 command">using</span> η <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> bij_betw_iff_bijections g_def<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> *<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="keyword1">analytic_on</span> UNIV <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="bound">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">n</span> <span class="main">≤</span> card <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">using</span> that<span>
      </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted skolem">n</span><span class="main">)</span><span>
        </span><span class="keyword3 command">case</span> 0<span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
          </span><span class="keyword1 command">using</span> analytic_on_const <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
      </span><span class="keyword1 command">next</span><span>
        </span><span class="keyword3 command">case</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">h</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="keyword1">analytic_on</span> UNIV<span>"</span></span> <span class="keyword2 keyword">and</span> hg<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">using</span> Suc_leD <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
        </span><span class="keyword3 command">define</span> <span class="skolem skolem">p</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> <span class="skolem">w</span> <span class="bound">i</span><span>"</span></span><span>
        </span><span class="keyword1 command">have</span> p0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">z</span><span>
          </span><span class="keyword1 command">unfolding</span> p_def <span class="keyword1 command">by</span> <span class="operator">force</span><span>
        </span><span class="keyword3 command">obtain</span> <span class="skolem skolem">d</span> <span class="keyword2 keyword">where</span> d<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span>"</span></span><span>
          </span><span class="keyword1 command">using</span> <span class="quoted quoted"><span>‹</span>infinite <span class="skolem">D</span><span>›</span></span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> ex_in_conv finite.emptyI infinite_remove<span class="main">)</span><span>
        </span><span class="keyword3 command">define</span> <span class="skolem skolem">h'</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">h'</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">z</span> <span class="main">+</span> <span class="skolem">p</span> <span class="bound">z</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">have</span> h'_eq<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">h'</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span><span>
          </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> h'_def p0<span class="main">)</span><span>
        </span><span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
        </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">intro</span> exI strip conjI<span class="main">)</span><span>
          </span><span class="keyword1 command">have</span> nless<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">n</span> <span class="main">&lt;</span> card <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span>
            </span><span class="keyword1 command">using</span> Suc.prems Suc_le_eq <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
          </span><span class="keyword1 command">with</span> η <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">η</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">η</span> <span class="skolem">i</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span><span>
            </span><span class="keyword1 command">using</span> that <span class="keyword1 command">unfolding</span> bij_betw_iff_bijections<span>
            </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> lessThan_iff less_not_refl order_less_trans<span class="main">)</span><span>
          </span><span class="keyword1 command">with</span> ζ η γ <span class="keyword1 command">have</span> pwn_nonzero<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span>"</span></span><span>
            </span><span class="keyword1 command improper command">apply</span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> p0 w_def bij_betw_iff_bijections<span class="main">)</span><span>
            </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Ord_ω1 Ord_trans nless lessThan_iff order_less_trans<span class="main">)</span><span>
          </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">h'</span> <span class="keyword1">analytic_on</span> UNIV<span>"</span></span><span>
            </span><span class="keyword1 command">unfolding</span> h'_def p_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic dynamic">analytic_intros</span> <span class="quoted quoted"><span>‹</span><span class="skolem">h</span> <span class="keyword1">analytic_on</span> UNIV<span>›</span></span><span class="main">)</span><span>
          </span><span class="keyword3 command">fix</span> <span class="skolem">i</span><span>
          </span><span class="keyword3 command">assume</span> <span class="quoted quoted"><span>"</span><span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span><span>"</span></span><span>
          </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> §<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span><span>"</span></span><span>
            </span><span class="keyword1 command">by</span> <span class="operator">linarith</span><span>
          </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">h'</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span>"</span></span><span>
            </span><span class="keyword1 command">using</span> h'_eq hg d h'_def pwn_nonzero <span class="keyword1 command">by</span> <span class="operator">force</span><span>
          </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">h'</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span><span>"</span></span><span>
            </span><span class="keyword1 command">using</span> § h'_eq hg h'_def d pwn_nonzero <span class="keyword1 command">by</span> <span class="operator">fastforce</span><span>
        </span><span class="keyword1 command">qed</span><span>
      </span><span class="keyword1 command">qed</span><span>
      </span><span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
        </span><span class="keyword1 command">using</span> * <span class="main">[</span><span class="operator">OF</span> order_refl<span class="main">]</span> η that gf<span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> w_def bij_betw_iff_bijections inD_def<span class="main">)</span> <span class="operator">metis</span><span>
    </span><span class="keyword1 command">next</span><span>
      </span><span class="keyword3 command">case</span> False<span>
      </span><span class="keyword1 command">then</span> <span class="keyword3 command">obtain</span> <span class="skolem skolem">η</span> <span class="keyword2 keyword">where</span> η<span class="main">:</span> <span class="quoted quoted"><span>"</span>bij_betw <span class="skolem">η</span> <span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> γ <span>countable_infiniteE'</span> less_ω1_imp_countable<span class="main">)</span><span>
      </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span>η_inject</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">η</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">η</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span> <span class="skolem">j</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> bij_betw_imp_inj_on inj_eq<span class="main">)</span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">g</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">g</span> <span class="main">≡</span> <span class="skolem">f</span> <span class="keyword1">o</span> <span class="skolem">η</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">w</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">w</span> <span class="main">≡</span> <span class="skolem">ζ</span> <span class="keyword1">o</span> <span class="skolem">η</span><span>"</span></span><span>
      </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> w_inject <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">w</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">w</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span> <span class="skolem">j</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> Ord_ω1 Ord_trans UNIV_I η γ ζ bij_betw_iff_bijections comp_apply<span class="main">)</span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">p</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> <span class="skolem">w</span> <span class="bound">i</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">q</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">q</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">h</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">ε</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="bound">ε</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="bound">z</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">BALL</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">BALL</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">ε</span><span class="main">.</span> ball <span class="main">(</span><span class="skolem">h</span> <span class="bound">n</span> <span class="bound">ε</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">p</span> <span class="bound">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>fact <span class="bound">n</span> <span class="main">*</span> <span class="skolem">q</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
                  </span><span class="comment1"><span>― ‹</span>The demonimator above is the key to keeping the epsilons small<span>›</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">DD</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">DD</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">ε</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">∩</span> <span class="skolem">BALL</span> <span class="bound">n</span> <span class="bound">ε</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span> <span class="bound">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span><span>"</span></span><span>
      </span><span class="keyword3 command">define</span> <span class="skolem skolem">dd</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">dd</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">ε</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">DD</span> <span class="bound">n</span> <span class="bound">ε</span><span>"</span></span><span>
      </span><span class="keyword1 command">have</span> p0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">z</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">unfolding</span> p_def <span class="keyword1 command">by</span> <span class="operator">force</span><span>
      </span><span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">i</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> p0<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> q_gt0<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span> <span class="skolem">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">unfolding</span> q_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> norm_not_less_zero prod_pos<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">DD</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="main">≠</span> <span class="main">{}</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>
      </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> infinite <span class="main">(</span><span class="skolem">D</span> <span class="main">∩</span> ball <span class="skolem">z</span> <span class="skolem">r</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">z</span> <span class="skolem">r</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> islimpt_UNIV limpt_of_closure islimpt_eq_infinite_ball cloD<span class="main">)</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>infinite <span class="main">(</span><span class="skolem">D</span> <span class="main">∩</span> <span class="skolem">BALL</span> <span class="skolem">n</span> <span class="skolem">ε</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> BALL_def p0 q_gt0<span class="main">)</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> DD_def finite.emptyI infinite_remove<span class="main">)</span><span>
      </span><span class="keyword1 command">qed</span><span>
      </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> dd_in_DD<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="main">∈</span> <span class="skolem">DD</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> dd_def some_in_eq<span class="main">)</span><span>

      </span><span class="keyword1 command">have</span> h_cong<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">ε'</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">ε</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">ε'</span> <span class="bound">i</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="skolem">ε'</span><span>
        </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> h_def<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> dd_cong<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="main">=</span> <span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">ε'</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">ε</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">ε'</span> <span class="bound">i</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span> <span class="skolem">ε'</span><span>
        </span><span class="keyword1 command">using</span> that <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> dd_def DD_def BALL_def h_cong<span class="main">)</span><span>

      </span><span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="skolem">n</span> <span class="main">(</span>cut <span class="skolem">ε</span> less_than <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> cut_apply h_cong less_than_iff<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">dd</span> <span class="skolem">n</span> <span class="main">(</span>cut <span class="skolem">ε</span> less_than <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">ε</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> cut_apply dd_cong less_than_iff<span class="main">)</span><span>

      </span><span class="keyword3 command">define</span> <span class="skolem skolem">coeff</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">coeff</span> <span class="main">≡</span> wfrec less_than <span class="main">(</span><span class="main">λ</span><span class="bound">ε</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">dd</span> <span class="bound">n</span> <span class="bound">ε</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="bound">ε</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">have</span> coeff_eq<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">coeff</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">coeff</span> <span class="main">-</span> <span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">coeff</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> def_wfrec <span class="main main">[</span><span class="operator">OF</span> coeff_def<span class="main main">]</span><span class="main">)</span><span>

      </span><span class="keyword1 command">have</span> norm_coeff<span class="main">:</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">coeff</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>fact <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">q</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">using</span> dd_in_DD <span class="main">[</span><span class="operator">of</span> <span class="quoted skolem">n</span> <span class="quoted skolem">coeff</span><span class="main">]</span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> q_gt0 coeff_eq DD_def BALL_def dist_norm norm_minus_commute norm_divide <span class="dynamic dynamic">divide_simps</span><span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> h_truncated<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">coeff</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">coeff</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">k</span><span>
      </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">coeff</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="skolem">coeff</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="skolem">k</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">coeff</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> Suc_le_eq atLeast0LessThan le0 sum.atLeastLessThan_concat that<span class="main">)</span><span>
        </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="skolem">coeff</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="operator">simp</span><span>
        </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> h_def<span class="main">)</span><span>
      </span><span class="keyword1 command">qed</span><span>
      </span><span class="keyword1 command">have</span> norm_p_bound<span class="main">:</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span><span>
          </span><span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span>dist <span class="skolem">z</span> <span class="skolem">z'</span> <span class="main">≤</span> <span class="main">1</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span> <span class="skolem">z</span> <span class="skolem">z'</span><span>
      </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted skolem">n</span> <span class="main">)</span><span>
        </span><span class="keyword3 command">case</span> 0<span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> p_def q_def<span class="main">)</span><span>
      </span><span class="keyword1 command">next</span><span>
        </span><span class="keyword3 command">case</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>norm <span class="skolem">z'</span> <span class="main">-</span> norm <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> dist_norm norm_triangle_ineq3 that<span class="main">)</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> §<span class="main">:</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> mult.commute add_mono distrib_left norm_triangle_le_diff<span class="main">)</span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Suc mult.commute mult_left_mono norm_ge_zero<span class="main">)</span><span>
        </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">smt</span> <span class="main main">(</span>verit<span class="main main">)</span> <span class="quoted"><span>"</span>§<span>"</span></span> Suc mult.assoc mult_left_mono norm_ge_zero<span class="main">)</span><span>
        </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> mult_ac<span class="main">)</span><span>
        </span><span class="keyword1 command">finally</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span> <span class="keyword1 command">.</span><span>
        </span><span class="keyword1 command">with</span> that <span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> p_def q_def norm_mult <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main main">:</span> fact_Suc<span class="main">)</span><span>
      </span><span class="keyword1 command">qed</span><span>

      </span><span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
      </span><span class="keyword1 command">proof</span><span>
        </span><span class="keyword3 command">define</span> <span class="skolem skolem">hh</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">coeff</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="bound">z</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="keyword1">holomorphic_on</span> UNIV<span>"</span></span><span>
        </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">rule</span> holomorphic_uniform_sequence<span class="main">)</span><span>
          </span><span class="keyword3 command">fix</span> <span class="skolem">n</span>   <span class="comment1"><span>―‹</span>Many thanks to Manuel Eberl for suggesting these approach<span>›</span></span><span>
          </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">h</span> <span class="skolem">n</span> <span class="skolem">coeff</span> <span class="keyword1">holomorphic_on</span> UNIV<span>"</span></span><span>
            </span><span class="keyword1 command">unfolding</span> h_def p_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic dynamic">holomorphic_intros</span><span class="main">)</span><span>
        </span><span class="keyword1 command">next</span><span>
          </span><span class="keyword3 command">fix</span> <span class="skolem">z</span><span>
          </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>uniform_limit <span class="main">(</span>cball <span class="skolem">z</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="skolem">coeff</span><span class="main">)</span> <span class="skolem">hh</span> sequentially<span>"</span></span><span>
            </span><span class="keyword1 command">unfolding</span> hh_def h_def<span>
          </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">rule</span> Weierstrass_m_test<span class="main">)</span><span>
            </span><span class="keyword1 command">let</span> <span class="var quoted var">?M</span> <span class="main">=</span> <span class="quoted quoted"><span>"</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span>"</span></span><span>
            </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound bound">n</span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">B</span><span>
            </span><span class="keyword1 command">proof</span><span>
              </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound bound">n</span><span class="main">≥</span>nat <span class="main">⌈</span><span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span class="main">⌉</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span>"</span></span><span>
                </span><span class="keyword1 command">using</span> norm_ge_zero <span class="main">[</span><span class="operator">of</span> <span class="quoted skolem">z</span><span class="main">]</span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> <span class="dynamic dynamic">divide_simps</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main main">:</span> norm_ge_zero<span class="main">)</span><span>
            </span><span class="keyword1 command">qed</span><span>
            </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> L<span class="main">:</span> <span class="quoted quoted"><span>"</span>liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span><span>"</span></span><span>
              </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> Lim_PInfty <span class="quasi_keyword">flip</span><span class="main main">:</span> liminf_PInfty<span class="main">)</span><span>
            </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cmod <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span>"</span></span><span>
              </span><span class="keyword1 command">using</span> norm_ge_zero <span class="main">[</span><span class="operator">of</span> <span class="quoted skolem">z</span><span class="main">]</span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main main">:</span> norm_ge_zero<span class="main">)</span><span>
            </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>summable <span class="var">?M</span><span>"</span></span><span>
              </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule</span> ratio_test_convergence<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> add_nonneg_eq_0_iff L<span class="main">)</span><span>
            </span><span class="keyword3 command">fix</span> <span class="skolem">n</span> <span class="skolem">z'</span><span>
            </span><span class="keyword3 command">assume</span>  <span class="quoted quoted"><span>"</span><span class="skolem">z'</span> <span class="main">∈</span> cball <span class="skolem">z</span> <span class="main">1</span><span>"</span></span><span>
            </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">coeff</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">coeff</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span><span>
              </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> norm_p_bound norm_mult mem_cball mult.assoc mult_left_mono norm_ge_zero<span class="main">)</span><span>
            </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> fact <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span>"</span></span><span>
            </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span><span>
              </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">coeff</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> fact <span class="skolem">n</span><span>"</span></span><span>
                </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> divide_divide_eq_left less_divide_eq less_eq_real_def norm_coeff q_gt0<span class="main">)</span><span>
            </span><span class="keyword1 command">qed</span> <span class="operator">auto</span><span>
            </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">≤</span> <span class="var">?M</span> <span class="skolem">n</span><span>"</span></span><span>
              </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> <span class="dynamic dynamic">divide_simps</span><span class="main">)</span><span>
            </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>norm <span class="main">(</span><span class="skolem">coeff</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?M</span> <span class="skolem">n</span><span>"</span></span> <span class="keyword1 command">.</span><span>
          </span><span class="keyword1 command">qed</span><span>
          </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">∃</span><span class="bound bound">d</span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> cball <span class="skolem">z</span> <span class="bound">d</span> <span class="main">⊆</span> UNIV <span class="main">∧</span> uniform_limit <span class="main">(</span>cball <span class="skolem">z</span> <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="skolem">coeff</span><span class="main">)</span> <span class="skolem">hh</span> sequentially<span>"</span></span><span>
            </span><span class="keyword1 command">using</span> zero_less_one <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
        </span><span class="keyword1 command">qed</span> <span class="operator">auto</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="keyword1">analytic_on</span> UNIV<span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> analytic_on_open<span class="main">)</span><span>
        </span><span class="keyword1 command">have</span> hh_eq_dd<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">coeff</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
        </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
          </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">coeff</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span><span>
            </span><span class="keyword1 command">unfolding</span> hh_def h_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">intro</span> suminf_finite<span class="main">)</span> <span class="operator">auto</span><span>
          </span><span class="keyword1 command">also</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">…</span> <span class="main">=</span> <span class="skolem">dd</span> <span class="skolem">n</span> <span class="skolem">coeff</span><span>"</span></span><span>
            </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> p0 h_def p_def coeff_eq <span class="main main">[</span><span class="operator">of</span> <span class="quoted quoted"><span>"</span>Suc <span class="main">_</span><span>"</span></span><span class="main main">]</span> coeff_eq <span class="main main">[</span><span class="operator">of</span> <span class="quoted main">0</span><span class="main main">]</span><span class="main">)</span><span>
          </span><span class="keyword1 command">finally</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span> <span class="keyword1 command">.</span><span>
        </span><span class="keyword1 command">qed</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
          </span><span class="keyword1 command">using</span> DD_def dd_in_DD <span class="keyword1 command">by</span> <span class="operator">fastforce</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="skolem">inD</span> <span class="skolem">γ</span> <span class="skolem">hh</span><span>"</span></span><span>
          </span><span class="keyword1 command">unfolding</span> inD_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> η bij_betw_iff_bijections comp_apply w_def<span class="main">)</span><span>
        </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">hh</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">η</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">n</span><span>
          </span><span class="keyword1 command">using</span> DD_def dd_in_DD g_def hh_eq_dd <span class="keyword1 command">by</span> <span class="operator">auto</span><span>
        </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound">β</span><span class="main">∈</span>elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">hh</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="bound">β</span><span>"</span></span><span>
          </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> η bij_betw_imp_surj_on imageE<span class="main">)</span><span>
      </span><span class="keyword1 command">qed</span><span>
    </span><span class="keyword1 command">qed</span><span>
    </span><span class="keyword1 command">with</span> f <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
      </span><span class="keyword1 command">using</span> inj <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main main">=</span><span class="quoted quoted"><span>"</span><span class="skolem">h</span><span>"</span></span> <span class="keyword2 keyword quasi_keyword">in</span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> Φ_def inj_on_def<span class="main">)</span><span>
  </span><span class="keyword1 command">qed</span><span>
  </span><span class="keyword3 command">define</span> <span class="skolem skolem">G</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">G</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">@</span><span class="bound">h</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">γ</span> <span class="main">(</span><span class="main">(</span>restrict <span class="bound">f</span> <span class="main">(</span>elts <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="bound">γ</span><span class="main">:=</span><span class="bound">h</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
  </span><span class="keyword1 command">have</span> nxt<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">Φ</span> <span class="skolem">γ</span> <span class="main">(</span><span class="main">(</span>restrict <span class="skolem">f</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">γ</span><span class="main">:=</span> <span class="skolem">G</span> <span class="skolem">f</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">β</span> <span class="skolem">f</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">f</span> <span class="skolem">γ</span><span>
    </span><span class="keyword1 command">unfolding</span> G_def <span class="keyword1 command">using</span> * <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> someI<span class="main">)</span><span>
  </span><span class="keyword1 command">have</span> G_restr<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">G</span> <span class="main">(</span>restrict <span class="skolem">f</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="skolem">G</span> <span class="skolem">f</span> <span class="skolem">γ</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">f</span> <span class="skolem">γ</span><span>
    </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main main">:</span> G_def<span class="main">)</span><span>
  </span><span class="keyword3 command">define</span> <span class="skolem skolem">f</span> <span class="keyword2 keyword">where</span> <span class="quoted quoted"><span>"</span><span class="skolem">f</span> <span class="main">≡</span> transrec <span class="skolem">G</span><span>"</span></span><span>
  </span><span class="keyword1 command">have</span> Φf<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">Φ</span> <span class="skolem">β</span> <span class="skolem">f</span><span>"</span></span> <span class="keyword2 keyword">if</span> <span class="quoted quoted"><span>"</span><span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">β</span><span>
    </span><span class="keyword1 command">using</span> that<span>
  </span><span class="keyword1 command">proof</span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted skolem">β</span> <span class="quasi_keyword">rule</span><span class="main main">:</span> eps_induct<span class="main">)</span><span>
    </span><span class="keyword3 command">case</span> <span class="main">(</span>step <span class="skolem">γ</span><span class="main">)</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> *<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">∀</span><span class="bound">β</span><span class="main">∈</span>elts <span class="skolem">γ</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">β</span> <span class="skolem">f</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> Ord_ω1 Ord_trans <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
    </span><span class="keyword1 command">have</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted quoted"><span>"</span>inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">β</span><span class="main">.</span> <span class="skolem">G</span> <span class="main">(</span>restrict <span class="skolem">f</span> <span class="main">(</span>elts <span class="bound">β</span><span class="main">)</span><span class="main">)</span> <span class="bound">β</span><span class="main">)</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span> <span class="main">⟷</span> inj_on <span class="skolem">f</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> <span class="main main">(</span>no_types<span class="main main">,</span> lifting<span class="main main">)</span> f_def transrec inj_on_cong<span class="main">)</span><span>
    </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="skolem">f</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="skolem">G</span> <span class="skolem">f</span> <span class="skolem">γ</span><span>"</span></span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> G_restr transrec f_def step.prems<span class="main">)</span><span>
    </span><span class="keyword1 command">with</span> nxt <span class="main">[</span><span class="operator">OF</span> step.prems<span class="main">]</span> * <span class="keyword3 command">show</span> <span class="var quoted var">?case</span><span>
      </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Φ_def elts_succ fun_upd_same fun_upd_triv inj_on_restrict_eq restrict_upd<span class="main">)</span><span>
  </span><span class="keyword1 command">qed</span><span>
  </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> anf<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">β</span><span class="main">.</span> <span class="bound">β</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">β</span> <span class="keyword1">analytic_on</span> UNIV<span>"</span></span><span>
    </span><span class="keyword2 keyword">and</span> inD<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="main">⋀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="bound">α</span> <span class="main">∈</span> elts <span class="bound">β</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">β</span> <span class="main">(</span><span class="skolem">ζ</span> <span class="bound">α</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span>"</span></span><span>
    </span><span class="keyword1 command">using</span> Φ_def inD_def <span class="keyword1 command">by</span> <span class="operator">blast</span><span class="main keyword3">+</span><span>
  </span><span class="keyword1 command">have</span> injf<span class="main">:</span> <span class="quoted quoted"><span>"</span>inj_on <span class="skolem">f</span> <span class="main">(</span>elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">using</span> Φf <span class="keyword1 command">unfolding</span> inj_on_def Φ_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Ord_ω1 Ord_in_Ord Ord_linear_le in_succ_iff<span class="main">)</span><span>
  </span><span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
  </span><span class="keyword1 command">proof</span><span>
    </span><span class="keyword1 command">let</span> <span class="var quoted var">?F</span> <span class="main">=</span> <span class="quoted quoted"><span>"</span><span class="skolem">f</span> <span class="main">`</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span><span>
    </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>countable <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">f</span> <span class="main">`</span> elts ω1<span class="main">)</span><span>"</span></span> <span class="keyword2 keyword">for</span> <span class="skolem">z</span><span>
    </span><span class="keyword1 command">proof</span> <span class="operator">-</span><span>
      </span><span class="keyword3 command">obtain</span> <span class="skolem skolem">α</span> <span class="keyword2 keyword">where</span> α<span class="main">:</span> <span class="quoted quoted"><span>"</span><span class="skolem">ζ</span> <span class="skolem">α</span> <span class="main">=</span> <span class="skolem">z</span><span>"</span></span> <span class="quoted quoted"><span>"</span><span class="skolem">α</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">1</span><span class="main">)</span><span>"</span></span> <span class="quoted quoted"><span>"</span>Ord <span class="skolem">α</span><span>"</span></span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> Ord_ω1 Ord_in_Ord UNIV_I ζ bij_betw_iff_bijections<span class="main">)</span><span>
      </span><span class="keyword1 command">let</span> <span class="var quoted var">?B</span> <span class="main">=</span> <span class="quoted quoted"><span>"</span>elts ω1 <span class="main">-</span> elts <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span><span>"</span></span><span>
      </span><span class="keyword1 command">have</span> eq<span class="main">:</span> <span class="quoted quoted"><span>"</span>elts ω1 <span class="main">=</span> elts <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?B</span><span>"</span></span><span>
        </span><span class="keyword1 command">using</span> α <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> Diff_partition Ord_ω1 OrdmemD less_eq_V_def succ_le_iff<span class="main">)</span><span>
      </span><span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">f</span> <span class="main">`</span> <span class="var">?B</span> <span class="main">⊆</span> <span class="skolem">D</span><span>"</span></span><span>
        </span><span class="keyword1 command">using</span> α inD <span class="keyword1 command">by</span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">meson</span> Ord_ω1 Ord_in_Ord Ord_linear<span class="main">)</span><span>
      </span><span class="keyword1 command">then</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>countable <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">f</span> <span class="main">`</span> <span class="var">?B</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted quoted"><span>‹</span>countable <span class="skolem">D</span><span>›</span></span> countable_subset<span class="main">)</span><span>
      </span><span class="keyword1 command">moreover</span> <span class="keyword1 command">have</span> <span class="quoted quoted"><span>"</span>countable <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">f</span> <span class="main">`</span> elts <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span>"</span></span><span>
        </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main main">:</span> α less_ω1_imp_countable<span class="main">)</span><span>
      </span><span class="keyword1 command">ultimately</span> <span class="keyword3 command">show</span> <span class="var quoted var">?thesis</span><span>
        </span><span class="keyword1 command">using</span> eq <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> countable_Un_iff image_Un<span class="main">)</span><span>
    </span><span class="keyword1 command">qed</span><span>
    </span><span class="keyword1 command">then</span> <span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>Wetzel <span class="var">?F</span><span>"</span></span><span>
      </span><span class="keyword1 command">unfolding</span> Wetzel_def <span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main main">:</span> anf<span class="main">)</span><span>
    </span><span class="keyword3 command">show</span> <span class="quoted quoted"><span>"</span>uncountable <span class="var">?F</span><span>"</span></span><span>
      </span><span class="keyword1 command">using</span> Ord_ω1 countable_iff_less_ω1 countable_image_inj_eq injf <span class="keyword1 command">by</span> <span class="operator">blast</span><span>
  </span><span class="keyword1 command">qed</span><span>
</span><span class="keyword1 command">qed</span>
</pre>



<pre class="source">
<span class="keyword1 command">theorem</span> Erdos_Wetzel<span class="main">:</span> <span class="quoted quoted"><span>"</span>C_continuum <span class="main">=</span> <span class="main">ℵ</span><span class="main">1</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span><span class="main">.</span> Wetzel <span class="bound">F</span> <span class="main">∧</span> uncountable <span class="bound">F</span><span class="main">)</span><span>"</span></span><span>
  </span><span class="keyword1 command">by</span> <span class="main">(</span><span class="operator">metis</span> C_continuum_ge Erdos_Wetzel_CH Erdos_Wetzel_nonCH TC_small less_V_def<span class="main">)</span>
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



<pre class="source">
</pre>



XXX


XXX

$$
\begin{align*}
 D_\infty \cong [D_\infty\to D_\infty]
\end{align*}
$$


[mentioned earlier]({% post_url 2022-02-23-Hereditarily_Finite %}).

 [pointed out before]({% post_url 2022-03-16-Types_vs_Sets %})
 



Filling all these gaps in the libraries seemed to involve more effort (and space in the [theory file](https://www.isa-afp.org/entries/Wetzels_Problem.html)) than the Wetzel problem itself. 

The project took 18 days and I hope to write more about it soon.
